---
title: "Q Change Research"
author: "Zehao Qian"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# --------------------------------------------------------
gc()
rm(list = ls())
graphics.off()
cat("\014")
# --------------------------------------------------------
folder_name <- "./pic_q_change_research"
if (dir.exists(folder_name)) {
  unlink(folder_name, recursive = TRUE)
}
dir.create(folder_name)
```

Data Set: Simulation 2

-   N = 1000

-   p = 0.02

-   q = 0.3, 0.4, 0.5

-   Iteration = 25

```{r}
library(data.table)
simulation2_results = fread("./simulation2.csv")
```

```{r}
library(tidyr)
library(dplyr)
q.change.research = simulation2_results %>%
  filter(AgentID == 100, Step == 100)


data.q.change.long <- q.change.research %>%
  pivot_longer(cols = starts_with("Steps_to"), 
               names_to = "Step_Percent", 
               values_to = "Steps_Count") %>%
  mutate(q_number = case_when(
    q == 0.3 ~ "q = 0.3",
    q == 0.4 ~ "q = 0.4",
    q == 0.5 ~ "q = 0.5",
    TRUE ~ NA_character_  # other cases
  ))

```

```{r fig.height=8, fig.width=12}
library(ggplot2)

box = ggplot(data.q.change.long) +
  aes(x = q_number, y = Steps_Count, fill = q) +
  geom_boxplot() +
  scale_fill_gradient() +
  labs(
    x = "Different Q Number",
    y = "Steps Count",
    title = "Boxplot for Potential User Acceptance Ratio",
    subtitle = "When the acceptance probability of imitator changes (q)"
  ) +
  theme_light() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  ) +
  facet_wrap(vars(Step_Percent))

ggsave("./pic_q_change_research/box.png",
       plot = box,
       device = "png",
       height = 8,
       width = 12)

box
```

```{r fig.height=6, fig.width=10}
line.data = simulation2_results %>%
  filter(AgentID == 0)

ribbon_data = line.data %>%
  group_by(Step, q) %>%
  summarise(
    ymin = min(Adopted_Count),
    ymax = max(Adopted_Count),
    y_mean = mean(Adopted_Count)
  )

# create a combined-plot with both scatter and ribbon plot
combined_plot <- ggplot() +
  geom_ribbon(
    data = ribbon_data,
    aes(x = Step, ymin = ymin, ymax = ymax),
    alpha = 0.3,
    fill = "blue"
  ) +
  geom_line(
    data = ribbon_data,
    aes(x = Step, y = y_mean),
    color = "red",
    size = 1.5
  ) +
  geom_point(
    data = line.data,
    aes(x = Step, y = Adopted_Count, colour = RunId),
    size = 1.6,
    shape = "circle small"
  ) +
  scale_color_viridis_c() +
  labs(
    x = 'Steps Count',
    y = 'Adopted User Count',
    title = "Ribbon and Scatter Plot Comparison with Different P Value",
    subtitle = "N=1000, iteration=25"
  ) +
  theme_light() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  ) +
  facet_wrap(vars(q))

ggsave("./pic_q_change_research/combined_plot.png",
       plot = combined_plot,
       device = "png",
       height = 6,
       width = 10)

combined_plot
```

```{r}

```
